(function(C,d,t,U,e,I,W,o,T,p){"use strict";var h={Failed:o.getAssetIDByName("Small"),Delete:o.getAssetIDByName("ic_message_delete"),Copy:o.getAssetIDByName("toast_copy_link"),Open:o.getAssetIDByName("ic_leave_stage"),Clipboard:o.getAssetIDByName("pending-alert"),Clock:o.getAssetIDByName("clock"),Forum:o.getAssetIDByName("ic_forum_channel"),Settings:{Toasts:{Settings:o.getAssetIDByName("ic_selection_checked_24px"),Failed:o.getAssetIDByName("ic_close_circle_24px")},Initial:o.getAssetIDByName("coffee"),Update:o.getAssetIDByName("discover"),Locale:o.getAssetIDByName("ic_locale_24px"),External:o.getAssetIDByName("ic_raised_hand_list"),Edit:o.getAssetIDByName("ic_edit_24px"),Delete:o.getAssetIDByName("ic_delete_24px"),Reply:o.getAssetIDByName("ic_reply_24px"),Keyboard:o.getAssetIDByName("ic_keyboard_24px")}},g={shadow:function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:.1;return{shadowColor:"#000",shadowOffset:{width:1,height:4},shadowOpacity:a,shadowRadius:4.65,elevation:8}},displayToast:function(a,r){t.toasts.open({content:r=="clipboard"?`Copied ${a} to clipboard.`:a,source:r=="clipboard"?h.Clipboard:h.Settings.Initial})}},M={plugin:{source:"https://github.com/MYSTRAVIL/vendetta-plugins"},author:{profile:{"Rosie<3":"https://github.com/acquitelol"}}};const{TouchableOpacity:v,View:_,Image:z,Text:N,Animated:S}=I.General,O=d.findByProps("transitionToGuild"),F=d.findByStoreName("UserStore"),q=d.findByProps("showUserProfile"),f=t.stylesheet.createThemedStyleSheet({container:{marginTop:25,marginLeft:"5%",marginBottom:-15,flexDirection:"row"},textContainer:{paddingLeft:15,paddingTop:5,flexDirection:"column",flexWrap:"wrap",...g.shadow()},image:{width:75,height:75,borderRadius:10,...g.shadow()},mainText:{opacity:.975,letterSpacing:.25},header:{color:T.semanticColors.HEADER_PRIMARY,fontFamily:t.constants.Fonts.DISPLAY_BOLD,fontSize:25,letterSpacing:.25},subHeader:{color:T.semanticColors.HEADER_SECONDARY,fontSize:12.75}});function X(a){let{name:r,authors:s}=a;const n=t.React.useRef(new S.Value(1)).current,i=function(){return S.spring(n,{toValue:1.1,duration:10,useNativeDriver:!0}).start()},l=function(){return S.spring(n,{toValue:1,duration:250,useNativeDriver:!0}).start()},b=function(){return q.showUserProfile({userId:F.getCurrentUser().id})},y={transform:[{scale:n}]};return t.React.createElement(t.React.Fragment,null,t.React.createElement(_,{style:f.container},t.React.createElement(v,{onPress:b,onPressIn:i,onPressOut:l},t.React.createElement(S.View,{style:y},t.React.createElement(z,{style:[f.image],source:{uri:F?.getCurrentUser()?.getAvatarURL()?.replace("webp","png")}}))),t.React.createElement(_,{style:f.textContainer},t.React.createElement(v,{onPress:function(){return O.openURL(M.plugin.source)}},t.React.createElement(N,{style:[f.mainText,f.header]},r)),t.React.createElement(_,{style:{flexDirection:"row"}},t.React.createElement(N,{style:[f.mainText,f.subHeader]},"A project by"),s.map(function(u,w,A){return t.React.createElement(v,{onPress:function(){return O.openURL(M.author.profile[u.name]??"https://github.com/")}},t.React.createElement(N,{style:[f.mainText,f.subHeader,{paddingLeft:4,fontFamily:t.constants.Fonts.DISPLAY_BOLD,flexDirection:"row"}]},u.name,w<A.length-1?",":null))})))))}const{View:J,Text:Q}=I.General,G=t.stylesheet.createThemedStyleSheet({text:{color:T.semanticColors.HEADER_SECONDARY,paddingLeft:"5.5%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:t.constants.Fonts.PRIMARY_BOLD,fontSize:12}});function $(a){let{label:r,children:s}=a;return t.React.createElement(J,{style:{marginTop:10}},t.React.createElement(Q,{style:[G.text,G.optionText]},r.toUpperCase()),s)}const{FormRow:c,FormSwitch:D,FormDivider:m,FormInput:Z,FormText:ee}=I.Forms,{ScrollView:te,View:x,Text:ae}=I.General,re=d.findByProps("transitionToGuild","openURL"),E=t.stylesheet.createThemedStyleSheet({icon:{color:T.semanticColors.INTERACTIVE_NORMAL},item:{color:T.semanticColors.TEXT_MUTED,fontFamily:t.constants.Fonts.PRIMARY_MEDIUM},container:{width:"90%",marginLeft:"5%",borderRadius:10,backgroundColor:T.semanticColors.BACKGROUND_MOBILE_SECONDARY,...g.shadow()},subheaderText:{color:T.semanticColors.HEADER_SECONDARY,textAlign:"center",margin:10,marginBottom:50,letterSpacing:.25,fontFamily:t.constants.Fonts.PRIMARY_BOLD,fontSize:14},image:{width:"100%",maxWidth:350,borderRadius:10}});function se(){e.storage.tapUsernameMention===void 0&&(e.storage.tapUsernameMention=!1),e.storage.reply===void 0&&(e.storage.reply=!0),e.storage.userEdit===void 0&&(e.storage.userEdit=!0),e.storage.userDelete===void 0&&(e.storage.userDelete=!1),e.storage.keyboardPopup===void 0&&(e.storage.keyboardPopup=!0),e.storage.delay===void 0&&(e.storage.delay="300"),W.useProxy(e.storage);const a=t.ReactNative.Platform.OS==="android",r=function(s){/^\d*$/.test(s)&&(e.storage.delay=s)};return t.React.createElement(te,null,t.React.createElement(X,{name:e.manifest.name,authors:e.manifest.authors}),t.React.createElement(x,{style:{marginTop:20}},t.React.createElement($,{label:"Preferences"},t.React.createElement(x,{style:[E.container]},t.React.createElement(c,{label:"Tap Username to Mention",subLabel:`Allows you to tap on a username to mention them instead of opening their profile.${a?" This option is disabled on Android.":""}`,onLongPress:function(){return g.displayToast("By default, Discord opens a profile when tapping on a username in chat. With this, it now mentions them, like on Android.","tooltip")},leading:t.React.createElement(c.Icon,{style:E.icon,source:e.storage.tapUsernameMention?h.Forum:h.Failed}),trailing:t.React.createElement(D,{value:a?!1:e.storage.tapUsernameMention,onValueChange:function(){a||(e.storage.tapUsernameMention=!e.storage.tapUsernameMention)}}),disabled:a}),t.React.createElement(m,null),t.React.createElement(c,{label:"Double Tap To Reply",subLabel:"Allows you to double tap on any messages to reply to them.",onLongPress:function(){return g.displayToast("Double tapping anyones message allows you to reply to them!","tooltip")},leading:t.React.createElement(c.Icon,{style:E.icon,source:e.storage.reply?h.Settings.Reply:h.Failed}),trailing:t.React.createElement(D,{value:e.storage.reply,onValueChange:function(){e.storage.reply=!e.storage.reply}})}),t.React.createElement(m,null),t.React.createElement(c,{label:"Open Keyboard Automatically",subLabel:"Opens the Keyboard when you reply to or edit a message with a double tap.",onLongPress:function(){return g.displayToast("Opens the Keyboard when you reply to or edit a message with a double tap.","tooltip")},leading:t.React.createElement(c.Icon,{style:E.icon,source:e.storage.keyboardPopup?h.Settings.Keyboard:h.Failed}),trailing:t.React.createElement(D,{value:e.storage.keyboardPopup,onValueChange:function(){e.storage.keyboardPopup=!e.storage.keyboardPopup}})}),t.React.createElement(m,null),t.React.createElement(c,{label:"Double tap to edit your own messages",subLabel:"Allows you to double tap on any of your own messages to edit them.",onLongPress:function(){return g.displayToast("When double tapping on any of your own messages, you can now edit them!","tooltip")},leading:t.React.createElement(c.Icon,{style:E.icon,source:h.Settings.Edit}),trailing:t.React.createElement(D,{value:e.storage.userEdit,onValueChange:function(){e.storage.userEdit=!e.storage.userEdit}})}),t.React.createElement(m,null),t.React.createElement(c,{label:"Double tap to delete your own messages",subLabel:"Allows you to double tap on any of your own messages to delete them.",onLongPress:function(){return g.displayToast("When double tapping on any of your own messages, you can now delete them!","tooltip")},leading:t.React.createElement(c.Icon,{style:E.icon,source:h.Settings.Delete}),trailing:t.React.createElement(D,{value:e.storage.userDelete,onValueChange:function(){e.storage.userDelete=!e.storage.userDelete}})}),t.React.createElement(m,null),t.React.createElement(Z,{value:e.storage.delay,onChange:r,placeholder:"300",title:"Maximum Delay",keyboardType:"numeric"}),t.React.createElement(m,null),t.React.createElement(ee,{style:{padding:10}},"The maximum delay between taps until the double tap event is cancelled. This is 300ms by default."))),t.React.createElement($,{label:"Source"},t.React.createElement(x,{style:E.container},t.React.createElement(c,{label:"Source",subLabel:`Open the repository of ${e.manifest.name} externally.`,onLongPress:function(){return g.displayToast(`Opens the repository of ${e.manifest.name} on GitHub in an external page to view any source code of the plugin.`,"tooltip")},leading:t.React.createElement(c.Icon,{style:E.icon,source:h.Open}),trailing:function(){return t.React.createElement(c.Arrow,null)},onPress:function(){return re.openURL(M.plugin.source)}})))),t.React.createElement(ae,{style:E.subheaderText},`Build: (${e.manifest.hash?.substring(0,8)||"dev"}`))}const H=d.findByProps("insertText"),ne=d.findByStoreName("ChannelStore"),k=d.findByStoreName("MessageStore"),V=d.findByStoreName("UserStore"),Y=d.findByProps("sendMessage","startEditMessage","startDeleteMessage"),K=d.findByProps("createPendingReply"),{MessagesHandlers:L}=d.findByProps("MessagesHandlers"),oe={unpatchGetter:null,unpatchHandlers:null,currentTapIndex:0,currentMessageID:null,timeoutTap:null,patches:[],doubleTapState(a){let{state:r="UNKNOWN",nativeEvent:s}=a;try{const n={state:r,data:s};r==="INCOMPLETE"&&s&&Object.assign(n,{reason:{required:{taps:2,isAuthor:!0},received:{taps:s.taps,isAuthor:s.isAuthor}}});const i=V?.getCurrentUser();i&&e.manifest.authors.find(function(l){return l.id===i.id})&&console.log("DoubleTapState",n)}catch(n){p.logger.error("BetterChatGestures: Error in doubleTapState",n)}},resetTapState(){try{this.timeoutTap&&(clearTimeout(this.timeoutTap),this.timeoutTap=null),this.currentTapIndex=0,this.currentMessageID=null}catch(a){p.logger.error("BetterChatGestures: Error in resetTapState",a)}},patchHandlers(a){var r=this;if(!a.__bcg_patched){a.__bcg_patched=!0;try{if(a.handleTapUsername&&e.storage.tapUsernameMention){const s=U.instead("handleTapUsername",a,function(n,i){try{if(!e.storage.tapUsernameMention||!n?.[0]?.nativeEvent)return i.apply(a,n);const l=H.refs?.[0]?.current,{messageId:b}=n[0].nativeEvent;if(!l?.props?.channel?.id)return i.apply(a,n);const y=k.getMessage(l.props.channel.id,b);if(!y?.author)return i.apply(a,n);const u=y.author.discriminator!=="0"?`#${y.author.discriminator}`:"";H.insertText(`@${y.author.username}${u}`)}catch(l){return p.logger.error("BetterChatGestures: Error in handleTapUsername patch",l),i.apply(a,n)}});this.patches.push(s)}if(a.handleTapMessage){const s=U.after("handleTapMessage",a,function(n){try{if(!n?.[0])return;const{nativeEvent:i}=n[0];if(!i)return;const l=i.channelId,b=i.messageId;if(!l||!b)return;const y=ne.getChannel(l),u=k.getMessage(l,b);if(!u)return;r.currentMessageID===b?r.currentTapIndex++:(r.resetTapState(),r.currentTapIndex=1,r.currentMessageID=b);let w=300;if(e.storage.delay){const R=parseInt(e.storage.delay,10);!isNaN(R)&&R>0&&(w=R)}r.timeoutTap&&clearTimeout(r.timeoutTap),r.timeoutTap=setTimeout(function(){r.resetTapState()},w);const A=V.getCurrentUser(),P=A&&u.author?u.author.id===A.id:!1,B={...i,taps:r.currentTapIndex,content:u.content||"",authorId:u.author?.id,isAuthor:P};if(r.currentTapIndex!==2){r.doubleTapState({state:"INCOMPLETE",nativeEvent:B});return}const j=r.currentMessageID;if(r.resetTapState(),P?e.storage.userEdit?Y.startEditMessage(l,j,B.content):e.storage.userDelete?Y.startDeleteMessage(l,j,B.content):e.storage.reply&&y&&K.createPendingReply({channel:y,message:u,shouldMention:!0}):e.storage.reply&&y&&K.createPendingReply({channel:y,message:u,shouldMention:!0}),(P&&(e.storage.userEdit||e.storage.reply)||!P&&e.storage.reply)&&e.storage.keyboardPopup)try{const R=d.findByProps("openSystemKeyboard");R&&R.openSystemKeyboardForLastCreatedInput()}catch(R){p.logger.error("BetterChatGestures: Error opening keyboard",R)}r.doubleTapState({state:"COMPLETE",nativeEvent:B})}catch(i){p.logger.error("BetterChatGestures: Error in handleTapMessage patch",i),r.resetTapState()}});this.patches.push(s)}this.unpatchHandlers=function(){try{r.patches.forEach(function(s){typeof s=="function"&&s()}),r.patches=[],a.__bcg_patched&&delete a.__bcg_patched}catch(s){p.logger.error("BetterChatGestures: Error in unpatchHandlers",s)}}}catch(s){p.logger.error("BetterChatGestures: Error in patchHandlers",s)}}},onLoad(){try{e.storage.tapUsernameMention??=t.ReactNative.Platform.select({android:!1,ios:!0,default:!0}),t.ReactNative.Platform.OS==="android"&&(e.storage.tapUsernameMention=!1),e.storage.reply??=!0,e.storage.userEdit??=!0,e.storage.userDelete??=!1,e.storage.keyboardPopup??=!1,e.storage.delay??="300",(!e.storage.delay||e.storage.delay===""||isNaN(parseInt(e.storage.delay,10))||parseInt(e.storage.delay,10)<=0)&&(e.storage.delay="300"),p.logger.log("BetterChatGestures: initialized with delay =",e.storage.delay);const a=this,r=Object.getOwnPropertyDescriptor(L.prototype,"params")?.get;r&&Object.defineProperty(L.prototype,"params",{configurable:!0,get(){return this&&a.patchHandlers.call(a,this),r.call(this)}}),this.unpatchGetter=function(){try{r&&Object.defineProperty(L.prototype,"params",{configurable:!0,get:r})}catch(s){p.logger.error("BetterChatGestures: Error in unpatchGetter",s)}}}catch(a){p.logger.error("BetterChatGestures: Error in onLoad",a)}},onUnload(){try{this.resetTapState(),this.unpatchGetter&&this.unpatchGetter(),this.unpatchHandlers&&this.unpatchHandlers(),this.timeoutTap&&(clearTimeout(this.timeoutTap),this.timeoutTap=null)}catch(a){p.logger.error("BetterChatGestures: Error in onUnload",a)}},settings:se};return C.default=oe,Object.defineProperty(C,"__esModule",{value:!0}),C})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.plugin,vendetta.ui.components,vendetta.storage,vendetta.ui.assets,vendetta.ui,vendetta);
